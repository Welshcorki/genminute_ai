{% extends "layout.html" %}

{% block title %}{{ title or '회의록 뷰어' }}{% endblock %}

{% block content %}
<main class="content-panel">
    <div class="viewer-container">
        <header class="viewer-header">
            <h1 id="meeting-title">회의록 로딩 중...</h1>
        </header>

        <!-- 회의 정보 섹션 -->
        <div class="meeting-info-section">
            <div class="meeting-date">
                <span id="meeting-date-display">날짜 로딩 중...</span>
            </div>
            <div class="meeting-participants">
                <div class="participants-list" id="participants-list">
                    <!-- 참석자 아이콘들이 동적으로 추가됨 -->
                </div>
                <button class="speaker-share-btn" id="speaker-share-btn" title="화자별 점유율 보기">
                    📊
                </button>
            </div>
        </div>

        <div class="player-container">
            <!-- 비디오 플레이어 (MP4용) -->
            <video id="video-player" controls style="display: none;"></video>
            <!-- 오디오 플레이어 (WAV, MP3, M4A, FLAC용) -->
            <audio id="audio-player" controls style="display: none;"></audio>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tabs-container">
            <button class="tab-button active" data-tab="script">스크립트</button>
            <button class="tab-button" data-tab="summary">문단 요약</button>
            <button class="tab-button" data-tab="minutes">회의록</button>
        </div>

        <!-- 탭 컨텐츠 -->
        <div class="tab-content-container">
            <!-- 스크립트 탭 -->
            <div id="script-tab" class="tab-content active">
                <div id="transcript-container" class="transcript-container">
                    <p>데이터를 불러오는 중입니다...</p>
                </div>
            </div>

            <!-- 문단 요약 탭 -->
            <div id="summary-tab" class="tab-content">
                <div id="summary-container" class="summary-container">
                    <p class="summary-placeholder">문단 요약을 불러오는 중입니다...</p>
                </div>
            </div>

            <!-- 회의록 탭 -->
            <div id="minutes-tab" class="tab-content">
                <div id="minutes-container" class="minutes-container minutes-empty">
                    <p class="minutes-placeholder">회의록 생성 버튼을 눌러 정식 회의록을 작성하세요.</p>
                    <button id="generate-minutes-button" class="btn-primary">회의록 생성</button>
                </div>
            </div>
        </div>

        <!-- 화자별 점유율 모달 -->
        <div id="speaker-share-modal" class="speaker-share-modal">
            <div class="speaker-share-modal-content">
                <div class="speaker-share-modal-header">
                    <h3>화자별 대화 점유율</h3>
                    <button class="modal-close-btn" id="close-share-modal">&times;</button>
                </div>
                <div class="speaker-share-modal-body">
                    <canvas id="speakerShareChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
    <!-- meeting_id를 JavaScript로 전달 -->
    <script>
        const MEETING_ID = "{{ meeting_id }}";
    </script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>
{% endblock %}