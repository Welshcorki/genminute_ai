# 🚨 발표 전 필수 테스트 가이드

**중요**: 발표 전에 반드시 이 테스트를 직접 실행해보세요!

---

## ✅ 코드 검증 완료 사항

### 1. 문법 검사 완료
- ✅ 모든 Python 파일 (app.py, utils/*.py) 문법 오류 없음
- ✅ 수정한 db_manager.py 문법 검증 완료
- ✅ 수정한 vector_db_manager.py 문법 검증 완료
- ✅ 수정한 user_manager.py 문법 검증 완료

### 2. 수정한 버그
- ✅ `db_manager.py`: meeting_shares 삭제 로직 추가
- ✅ `vector_db_manager.py`: meeting_shares 로그 추가
- ✅ `db_manager.py` line 310: return 값에 shares 누락 수정

---

## 🧪 실제 구동 테스트 (필수!)

### Step 1: 환경 확인
```bash
# Conda 환경 활성화
conda activate genminute

# 또는 (환경 이름이 다른 경우)
conda env list
conda activate [환경이름]
```

### Step 2: Flask 앱 실행
```bash
# 프로젝트 디렉토리로 이동
cd /mnt/c/Users/SBA/Project/minute_ai

# Flask 앱 실행
python app.py
```

**기대 결과**:
```
📂 .env 파일 경로: ...
📂 .env 파일 존재: True
🔑 FIREBASE_API_KEY 로드: ...
🔑 FLASK_SECRET_KEY 로드: 있음
...
* Running on http://127.0.0.1:5000
```

**만약 에러가 나면**:
- ModuleNotFoundError: `conda activate genminute` 확인
- Firebase 오류: `.env` 파일 확인
- Port 5000 already in use: `lsof -i :5000` → `kill [PID]`

---

## 🎯 핵심 기능 테스트 (5분 소요)

### Test 1: 로그인 (1분)
1. 브라우저에서 `http://localhost:5000` 또는 ngrok URL 접속
2. Google 로그인 버튼 클릭
3. 계정 선택 및 로그인
4. ✅ 메인 페이지 정상 표시 확인

**체크포인트**:
- [ ] 왼쪽 메뉴 표시됨
- [ ] 사용자 이름 표시됨 (어드민이면 Debug 메뉴도)

---

### Test 2: 파일 업로드 & 회의록 생성 (2-3분)
1. "새노트 만들기" 클릭
2. 제목 입력: "테스트 회의"
3. 샘플 오디오 파일 선택
4. "업로드 및 처리 시작" 클릭
5. 처리 대기 (2-5분)

**체크포인트**:
- [ ] 파일 업로드 성공
- [ ] STT 처리 시작 로그 확인
- [ ] 회의록 페이지로 리다이렉트
- [ ] 타임라인 뷰 표시
- [ ] 요약 섹션 표시
- [ ] 화자별 점유율 차트 표시

**콘솔 확인사항**:
```
[HH:MM:SS] 📥 업로드 요청 수신
[HH:MM:SS] 🎧 Gemini STT API로 음성 인식 중: ...
[HH:MM:SS] 🤖 Gemini를 통해 요약 생성 중...
```

---

### Test 3: AI 챗봇 (1분)
1. 회의록 페이지에서 오른쪽 챗봇 탭 클릭
2. 질문 입력: "이번 회의 주제가 뭐야?"
3. 전송 버튼 클릭

**체크포인트**:
- [ ] 챗봇 사이드바 열림
- [ ] AI 답변 표시
- [ ] 출처(sources) 표시

---

### Test 4: 공유 기능 (1분)
1. "노트 보기" 메뉴 클릭
2. 노트 체크박스 선택
3. "공유" 버튼 클릭
4. 이메일 입력 (테스트 계정 이메일)
5. "공유" 버튼 클릭

**체크포인트**:
- [ ] 공유 모달 표시
- [ ] 이메일 입력 가능
- [ ] 공유 성공 메시지
- [ ] 페이지 새로고침 후 공유 유지

**다른 계정으로 확인**:
1. 로그아웃
2. 공유받은 계정으로 로그인
3. "공유 노트 보기" 클릭
4. [ ] 공유받은 노트 표시 확인

---

### Test 5: 삭제 기능 (⚠️ 중요 - 버그 수정 확인)
1. "노트 보기" 메뉴
2. 노트 체크박스 선택
3. "삭제" 버튼 클릭
4. 확인 모달에서 "예" 클릭

**콘솔 확인사항** (중요!):
```
📊 [SQLite DB 삭제 검증 시작] meeting_id = ...
[삭제 전] meeting_dialogues: X개
[삭제 前] meeting_minutes: X개
[삭제 전] meeting_shares: X개  ← 이 줄이 나와야 함!
---
[삭제 수행] meeting_dialogues: X개 삭제
[삭제 수행] meeting_minutes: X개 삭제
[삭제 수행] meeting_shares: X개 삭제  ← 이 줄이 나와야 함!
---
[삭제 후] meeting_shares: 0개 남음  ← 0이어야 함!
✅ SQLite DB 삭제 검증 성공
```

**데이터베이스 직접 확인** (선택):
```bash
# SQLite 설치되어 있는 경우
sqlite3 database/minute_ai.db

# meeting_shares 테이블 확인
SELECT * FROM meeting_shares WHERE meeting_id = '[삭제한_meeting_id]';
# 결과: 빈 결과 (삭제됨)

.quit
```

**체크포인트**:
- [ ] 삭제 성공 메시지
- [ ] 노트 목록에서 사라짐
- [ ] 콘솔에 meeting_shares 삭제 로그 표시
- [ ] meeting_shares 테이블에서 실제로 삭제됨

---

## 🚨 에러 발생 시 대응

### Case 1: Gemini API 에러
**증상**: "Gemini API가 빈 응답을 반환했습니다"
**원인**: API 키 문제 또는 일시적 오류
**해결**:
- `.env` 파일의 `GEMINI_API_KEY` 확인
- 다른 오디오 파일로 재시도
- 콘솔에서 `prompt_feedback` 확인

### Case 2: 공유 실패
**증상**: "해당 이메일의 사용자를 찾을 수 없습니다"
**원인**: 공유받을 사용자가 한 번도 로그인 안 함
**해결**:
- 공유받을 계정으로 먼저 로그인 (users 테이블에 등록)
- 그 후 공유 시도

### Case 3: meeting_shares 삭제 안 됨
**증상**: 콘솔에 meeting_shares 로그가 안 나옴
**원인**: 코드 수정 후 Flask 재시작 안 함
**해결**:
- Flask 앱 종료 (Ctrl+C)
- `python app.py` 재실행
- 캐시 문제면 `find . -name "*.pyc" -delete` 실행

### Case 4: ChromaDB 오류
**증상**: "Collection not found" 또는 벡터 검색 실패
**원인**: ChromaDB 데이터 손상
**해결**:
- `database/vector_db` 폴더 삭제
- Flask 재시작 (자동으로 재생성됨)
- 노트 다시 업로드

---

## 📋 테스트 체크리스트 (출력해서 사용)

```
□ Flask 앱 정상 실행
□ 로그인 성공 (일반 사용자)
□ 로그인 성공 (어드민)
□ 파일 업로드 성공
□ STT 처리 완료
□ 회의록 생성 완료
□ 타임라인/요약/차트 표시
□ 챗봇 질문 응답
□ 노트 공유 성공
□ 공유 노트 조회 성공
□ 노트 삭제 성공
□ meeting_shares 삭제 로그 확인 ⚠️ 중요!
□ 데이터베이스에서 실제 삭제 확인
```

---

## 💡 시연 시나리오 (발표용)

### 시나리오 A: 빠른 시연 (3분)
1. 이미 생성된 노트 클릭 → 회의록 보기 (30초)
2. 챗봇으로 3개 질문 (1분)
3. 공유 기능 시연 (30초)
4. 공유받은 계정으로 확인 (30초)
5. 삭제 기능 (30초)

### 시나리오 B: 전체 플로우 (5분)
1. 로그인 (10초)
2. 파일 업로드 (20초)
3. 처리 대기 (빨리감기 영상 사용, 10초)
4. 결과 확인 (1분)
5. 챗봇 (1분)
6. 공유 (30초)
7. 삭제 (30초)

**추천**: 시나리오 A + 백업 영상

---

## 🎬 백업 영상 준비 (필수!)

**왜 필요한가?**
- 라이브 데모 중 네트워크 오류
- Gemini API 일시적 오류
- 시간 부족

**촬영 내용**:
1. 전체 플로우 (로그인~삭제)
2. 중요 기능 클로즈업
3. 5분 이내로 편집

**영상 위치**: 발표 자료와 같은 폴더에 저장

---

## 📞 긴급 연락처 (발표 당일)

**Flask 앱 재시작 명령어**:
```bash
# 프로세스 찾기
ps aux | grep "python.*app.py"

# 강제 종료
kill -9 [PID]

# 재시작
python app.py
```

**ngrok 재시작** (외부 접속 필요 시):
```bash
ngrok http 5000
```

---

## ✅ 최종 확인

발표 1시간 전:
- [ ] Flask 앱 실행 중
- [ ] 테스트 계정 2개 로그인 가능
- [ ] 샘플 파일 준비됨
- [ ] 백업 영상 준비됨
- [ ] 발표 자료 완성
- [ ] 네트워크 연결 안정적

**이 체크리스트를 모두 완료하면 발표 준비 완료!** 🎉
